datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Ruta {
  id         Int      @id @default(autoincrement())
  nombre     String
  sector     String
  cobradorId Int
  cobrador   User     @relation(fields: [cobradorId], references: [id])
  clientes   Cliente[] @relation("SectorRuta")
  rutasClientes Cliente[] @relation("RutasCliente")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  userId    Int
  action    String
  entity    String
  entityId  Int
  details   String
  createdAt DateTime @default(now())
}

model User {
  id        Int       @id @default(autoincrement())
  nombre    String
  email     String    @unique
  password  String
  role      String
  active    Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  rutas     Ruta[]
  prestamos Prestamo[]
  gastos    Gasto[]
}

model Cliente {
  id                 Int        @id @default(autoincrement())
  tipoIdentificacion String
  identificacion     String     @unique
  nombres            String
  apellidos          String
  edad               Int?
  direccion          String
  telefono           String
  correo             String
  sectorId           Int
  sector             Ruta       @relation("SectorRuta", fields: [sectorId], references: [id])
  active             Boolean    @default(true)
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  prestamos          Prestamo[]
  rutas              Ruta[] @relation("RutasCliente")
}

model Prestamo {
  id          Int        @id @default(autoincrement())
  codigo      String     @unique
  monto       Decimal    @db.Decimal(12, 2)
  tasa        Float
  plazoDias   Int
  tipoPlazo   TipoPlazo  @default(DIA)
  fechaInicio DateTime
  estadoId    Int
  estado      Estado     @relation(fields: [estadoId], references: [id])
  clienteId   Int
  usuarioId   Int
  cliente     Cliente    @relation(fields: [clienteId], references: [id])
  usuario     User       @relation(fields: [usuarioId], references: [id])
  pagos       Pago[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Pago {
  id         Int       @id @default(autoincrement())
  prestamoId Int
  fecha      DateTime
  monto      Decimal    @db.Decimal(12, 2)
  estadoId   Int
  estado     Estado     @relation(fields: [estadoId], references: [id])
  prestamo   Prestamo   @relation(fields: [prestamoId], references: [id])
}

model Estado {
  id        Int        @id @default(autoincrement())
  nombre    String     @unique
  prestamos Prestamo[]
  pagos     Pago[]
}

enum TipoPlazo {
  DIA
  SEMANA
  MES
}

model Gasto {
  id          Int      @id @default(autoincrement())
  descripcion String
  monto       Decimal  @db.Decimal(12, 2)
  fecha       DateTime
  categoria   String
  active      Boolean  @default(true)
  usuarioId   Int
  usuario     User     @relation(fields: [usuarioId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
